# pdfminify
pdfminify is intended to re-compress PDF images while operating directly at PDF
level (i.e., no re-compression using PostScript). It parses the PDF file,
hashes all image references, re-links resources that are duplicate (i.e., have
the same MD5 hash value) and also is able to re-compress images which are
stored with lossless compression in order to use JPEG. It tries to calculate
the physical extent of the images (which, depending on the inclusion method,
can be a bit messy) and then is able to calculate the actual image resolution.
If it exceeds a given target resolution, it can also re-sample images (i.e.,
re-scaling them using ImageMagick) before re-integrating them into the target
PDF.

In particular, I wrote this software because PDFs generated by the libcairo PDF
export are *huge*. Images that are used are included a dozen times and only
lossless compression is used. Therefore I use pdfminify to decrease the
filesize later.

# Acknowledgment
pdfminify uses the Toy Parser Generator (TPG) of Christophe Delord
(http://cdsoft.fr/tpg/). It is included (tpg.py file) and licensed under the
GNU LGPL v2.1 or any later version. Despite its name, it is far from a toy. In
fact, it is the most beautiful parser generator I have ever worked with and
makes grammars and parsing exceptionally easy, even for people without any
previous parsing experience. If you need parsing and use Python, TPG is *the*
go-to solution I would recommend. Seriously, it's amazing. Check it out.

In order to be able to easily create PDF/A-1b files, pdfminify also includes
the ICC sRGB color profile "sRGB_IEC61966-2-1_black scaled.icc". It is
distributed under its own license which is included at the bottom of this
readme file.

# License
pdfminify is licensed under the GNU GPL v3 (except for external components as
TPG, which has its own license). Later versions of the GPL are explicitly
excluded.

TPG (Toy Parser Generator) and the ICC sRGB color profile fall under their
respective licenses.

# Requirements
pdfminify uses two external tools: identify and convert (both from
ImageMagick). It uses the former to determine the width, height, colorspace and
bits per component of image files and the latter to convert images from PNM
(the internal format that pdfminify is capable of writing natively) to JPEG.

# PDF reading/writing
pdfminify uses its own PDF parser because for this particular purpose, neither
PyPDF2 nor pdfrw (which I both tried to use) seem suitable. This PDF
reader/writer is therefore is implemented in its own (included) library in the
"llpdf" subdirectory. It's the "low-level PDF" library because in contrast to
other PDF libraries, it has very little abstraction of the PDF file itself (and
exposes all the ugly PDF internals to the poor user). Feel free to play around
with it as you like!

# Bugs
PDF is an inherently messy format and parsing it really isn't pretty. I've
implemented only what I needed to implement in order to get my job done. I'm
sure there's dozens of examples in which pdfminify just plainly doesn't work or
creates broken output PDFs. Please feel free to fix these errors and send in a
pull request. I think it's a genuinely useful tool and therefore would be nice
to support a wider variety of PDFs than just those that I happen to generate.

If you encounter an issue but are unable to fix it because you don't know
enough about Python, PDF (or either), I will still look at your issue if you
report it on GitHub. However due to my lack of time, I cannot promise that I
can fix it -- to be honest, PDF is so complicated that I'm not even sure that I
can find what the issue is. In any case, be sure to include a minimal example
PDF that demonstrates the issue in the bug report.

# ICC sRGB Color Profile License
As taken from http://www.color.org/srgbprofiles.xalter:

  To anyone who acknowledges that the file "sRGB_IEC61966-2-1_black
  scaled.icc" is provided "AS IS" WITH NO EXPRESS OR IMPLIED WARRANTY, permission
  to use, copy and distribute these file for any purpose is hereby granted
  without fee, provided that the file is not changed including the ICC copyright
  notice tag, and that the name of ICC shall not be used in advertising or
  publicity pertaining to distribution of the software without specific, written
  prior permission. ICC makes no representations about the suitability of this
  software for any purpose.
